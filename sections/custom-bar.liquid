{% for block in section.blocks %}
  {% case block.type %}
    {% when 'announcement' %}
      {% if template.name == 'index' or block.settings.justHomePage == false %}
        {% if block.settings.hideBar %}
          <div class="custom-bar custom-bar--{{ forloop.index }} ">
            <div class="custom-bar__text">
              <span class="custom-bar_message--{{ forloop.index }}">{{ block.settings.custom_bar }}</span>
              <a href="{{ block.settings.url }}" class="custom-bar_link">
                <span class="custom-bar_message--{{ forloop.index }}">{{ block.settings.custom_bar_link }}</span>
              </a>
            </div>
            <div class="custom-bar__icon">X</div>
          </div>
        {% endif %}
      {% endif %}

      <style>
        .custom-bar__text{
        display:flex;
        }
        .custom-bar{
          display:flex;
          justify-content:center;
          text-align: center;
        }
        .custom-bar--{{ forloop.index }} {
            background-color:{{ block.settings.bar_color }};
          }
        .custom-bar_link{
            text-decoration: none;
            padding-left:10px;
          }
        .custom-bar_message--{{ forloop.index }}{
              margin:0;
              text-transform: uppercase;
              color:{{ block.settings.text_color }};
        }
        .custom-bar__icon{
          position:absolute;
          right: 2%;
          top:15px;
          cursor:pointer;
        }
      </style>
  {% endcase %}
{% endfor %}

<script>
  const storage = localStorage.getItem('display');
  const button = document.querySelector('.custom-bar__icon');
  const hideBar = document.querySelector('.custom-bar ');

  button.addEventListener('click', function (e) {
    localStorage.setItem('display', 'none');
    hideBar.parentNode.style.display = 'none';
  });

  if (storage == 'none') {
    hideBar.parentNode.style.display = 'none';
  }
</script>

{% schema %}
{
  "name": "Custom Bar",
  "max_blocks": 1,
  "blocks": [
    {
      "type": "announcement",
      "name": "Announcement",
      "settings": [
        {
          "type": "checkbox",
          "id": "justHomePage",
          "default": false,
          "label": "Home Page Only"
        },
        {
          "type": "checkbox",
          "id": "hideBar",
          "default": true,
          "label": "Show announcement"
        },
        {
          "type": "richtext",
          "id": "custom_bar",
          "label": "Bar text"
        },
        {
          "type": "richtext",
          "id": "custom_bar_link",
          "label": "Bar link"
        },
        {
          "type": "url",
          "id": "url",
          "label": "Change URL"
        },
        {
          "type": "color",
          "id": "bar_color",
          "label": "Bar",
          "default": "#ff6347"
        },
        {
          "type": "color",
          "id": "text_color",
          "label": "Text",
          "default": "#FFFFFF"
        }
      ]
    }
  ]
}
{% endschema %}
